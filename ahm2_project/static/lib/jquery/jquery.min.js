$(document).ready(function() {
    // Mengurangi jumlah
    $('.btn-minus').click(function() {
        var pesananId = $(this).data('pesanan-id');
        var quantityInput = $('.quantity-input[data-pesanan-id="' + pesananId + '"]');
        var quantity = parseInt(quantityInput.val());

        if (quantity > 1) {
            quantityInput.val(quantity - 1);
            updateTotal(pesananId, quantity - 1);
        }
    });

    // Menambah jumlah
    $('.btn-plus').click(function() {
        var pesananId = $(this).data('pesanan-id');
        var quantityInput = $('.quantity-input[data-pesanan-id="' + pesananId + '"]');
        var quantity = parseInt(quantityInput.val());

        quantityInput.val(quantity + 1);
        updateTotal(pesananId, quantity + 1);
    });

    // Menghapus item
    $('.btn-primary').click(function() {
        var pesananId = $(this).data('pesanan-id');
        removeItem(pesananId);
    });

    // Fungsi untuk memperbarui total berdasarkan jumlah
    function updateTotal(pesananId, quantity) {
        // Melakukan permintaan AJAX untuk memperbarui jumlah dan total di sisi server
        $.ajax({
            url: '/update_cart/',
            type: 'POST',
            data: {
                pesanan_id: pesananId,
                quantity: quantity
            },
            success: function(response) {
                // Menangani respons dan memperbarui subtotal dan total di HTML keranjang
                // Anda mungkin perlu memodifikasi bagian ini berdasarkan implementasi sisi server Anda
                var subtotal = response.subtotal;
                var total = response.total;

                $('.subtotal').text(subtotal);
                $('.total').text(total);
            },
            error: function(xhr, status, error) {
                // Menangani kesalahan
            }
        });
    }

    // Fungsi untuk menghapus item
    function removeItem(pesananId) {
        // Melakukan permintaan AJAX untuk menghapus item dari keranjang di sisi server
        $.ajax({
            url: '/remove_item/',
            type: 'POST',
            data: {
                pesanan_id: pesananId
            },
            success: function(response) {
                // Menangani respons dan menghapus baris item dari HTML keranjang
                // Anda mungkin perlu memodifikasi bagian ini berdasarkan implementasi sisi server Anda
                $('.item-row[data-pesanan-id="' + pesananId + '"]').remove();
            },
            error: function(xhr, status, error) {
                // Menangani kesalahan
            }
        });
    }
});
